<app-page-title
  title="Anticipo Proveedor"
  [breadcrumbItems]="breadCrumbItems"
/>
<app-tabla-new
  #tabla
  [botonNuevo]="true"
  [smallTable]="false"
  [conOpciones]="false"
  [formato]="formato"
  [datosService]="anticipoProveedorService"
  getAll="getAll"
  [templateFila]="templateFila"
  [botonNuevo]="true"
  (alCrear)="crearAnticipo(nuevoAnticipo)"
></app-tabla-new>

<ng-template #templateFila let-fila="fila" let-cabeceras="cabeceras">
  <ng-template ngFor let-campo [ngForOf]="cabeceras">
    <ng-template
      *ngIf="formato.cabeceras[campo].visibleCheck; then tempTD"
    ></ng-template>
    <ng-template #tempTD>
      <td [ngSwitch]="campo">
        <div *ngSwitchCase="'acciones'">
          <button
            class="btn btn-sm btn-info me-1"
            tooltip="Ver detalles"
            (click)="verDetalles(fila, modalDetalle)"
          >
            <i class="mdi mdi-eye"></i>
          </button>
          <button
            class="btn btn-sm btn-warning me-1"
            tooltip="Devolucion"
            (click)="realizarDevolucion(devolucionAnticipo, fila)"
          >
            <i class="mdi mdi-keyboard-backspace"></i>
          </button>
        </div>
        <div *ngSwitchCase="'proveedor'">
          {{ fila["razonSocial"] }}
        </div>

        <div *ngSwitchCase="'nroDocumento'">
          {{ fila['nroDocumento'] }}
        </div>
        <div
          class="text-end"
          *ngSwitchCase="'montoAnticipo'"
          [ngClass]="fila['totalAnticipo'] >= 0 ? 'text-success' : 'text-danger'"
        >
          {{ fila["totalAnticipo"] | decimalAmount }}
        </div>
        <div
          class="text-end"
          *ngSwitchCase="'montoAplicacion'"
          [ngClass]="fila['totalAplicacionAnticipo'] >= 0 ? 'text-success' : 'text-danger'"
        >
          {{ fila["totalAplicacionAnticipo"] | decimalAmount }}
        </div>
        <div
          class="text-end"
          *ngSwitchCase="'saldo'"
          [ngClass]="fila['totalSaldo'] >= 0 ? 'text-success' : 'text-danger'"
        >
          {{ fila["totalSaldo"] | decimalAmount }}
        </div>
        <div *ngSwitchDefault>
          <td>{{ fila[campo] }}</td>
        </div>
      </td>
    </ng-template>
  </ng-template>
</ng-template>

<ng-template #nuevoAnticipo>
  <form-anticipo
    (cerrarModal)="modalRef.hide(); tabla.obtenerDatos()"
    (alActualizar)="modalRef.hide(); tabla.obtenerDatos()"
  ></form-anticipo>
</ng-template>

<ng-template #devolucionAnticipo>
  <form-devolucion
    [datosProveedor]="dataProveedor"
    (cerrarModal)="modalRef.hide(); tabla.obtenerDatos()"
    (alActualizar)="modalRef.hide(); tabla.obtenerDatos()"
  ></form-devolucion>
</ng-template>

<ng-template #modalDetalle>
  <detalle-anticipo
  [dataAnticipoProveedor]="dataProveedor"
  (cerrarModal)="modalRef.hide(); tabla.obtenerDatos()"
  ></detalle-anticipo>
</ng-template>
