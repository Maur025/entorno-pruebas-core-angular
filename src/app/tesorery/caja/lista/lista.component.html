<app-page-title [title]="breadCrumbTitle" [breadcrumbItems]="breadCrumbItems" />
<krn-tabla
	#tabla
	[titulo]="titulo"
	[datosService]="cajaService"
	getAll="getAll"
	[formato]="formato"
	[textoBuscar]="textoBuscar"
	[isSubtable]="rel_prefix ? true : false"
	[templateFila]="undefined"
	[smallTable]="false"
	[softDelete]="false"
	(crearNuevo)="(null)"
	(alCrear)="crear(modalGeneral)"
	(alActualizar)="(null)"
	(alFiltrar)="(null)"
	(alEditar)="editar($event, modalGeneral)"
	campoEstado="estado"
	valueEstado="habilitado"
	(alHabilitar)="habilitar($event, tabla, 'habilitar')"
	(alDeshabilitar)="habilitar($event, tabla, 'inhabilitar')"
	[botonExportar]="false"
	[botonImportar]="false"
	[conOpciones]="false"
	[templateFila]="templateFila"
/>

<ng-template #templateFila let-fila="fila" let-cabeceras="cabeceras">
	<ng-template ngFor let-campo [ngForOf]="cabeceras">
		<ng-template *ngIf="formato.cabeceras[campo].visibleCheck; then tempTD" />
		<ng-template #tempTD>
			<td [ngSwitch]="campo">
				<div *ngSwitchCase="'acciones'">
		<!--			<ul class="list-unstyled hstack gap-1 mb-0">
						<li
							data-bs-toggle="tooltip"
							data-bs-placement="top"
							title="Editar"
							*ngIf="!fila.aperturado"
						>
							<button
								class="btn btn-sm btn-soft-info"
								[disabled]="fila.deleted"
								(click)="editar(fila, modalGeneral)"
							>
								<i class="mdi mdi-pencil-outline"></i>
							</button>
						</li>
						<li
							data-bs-toggle="tooltip"
							data-bs-placement="top"
							title="Aperturar"
							*ngIf="!fila.aperturado"
						>
						 	<button
								class="btn btn-sm btn-primary"
								[disabled]="fila.deleted"
								(click)="aperturar(fila, modalGeneral)"
							>
								<i class="bx bx-lock-open-alt"></i>
							</button> 

              <button
                class="btn btn-sm btn-warning"
                [disabled]="fila.deleted"
                title="Aperturar Caja"
                (click)="aperturarCaja(fila, aperturaCierre)">
                <i class="bx bx-lock-open-alt"></i>
              </button>
						</li>
						<li
							data-bs-toggle="tooltip"
							data-bs-placement="top"
							title="Cierre"
							*ngIf="fila.aperturado"
						>
							<button
								class="btn btn-sm btn-soft-dark"
								(click)="cierre(fila, modalGeneral)"
							>
								<i class="mdi mdi-lock"></i>
							</button>
						</li>
						<li
							data-bs-toggle="tooltip"
							data-bs-placement="top"
							title="Detalle fondo"
						>
							<button class="btn btn-sm btn-info" (click)="detalleCaja(fila)">
								<i class="mdi mdi-eye"></i>
							</button>
						</li>
						<li
							data-bs-toggle="tooltip"
							data-bs-placement="top"
							title="Habilitar"
							*ngIf="fila.deleted"
						>
							<a
								class="btn btn-sm btn-success"
								(click)="habilitar(fila, tabla, 'habilitar')"
								><i class="mdi mdi-power"></i
							></a>
						</li>
						<li
							data-bs-toggle="tooltip"
							data-bs-placement="top"
							title="Inhabilitar"
							*ngIf="!fila.deleted"
						>
							<a
								data-bs-toggle="modal"
								class="btn btn-sm btn-danger"
								(click)="habilitar(fila, tabla, 'inhabilitar')"
								><i class="mdi mdi-power"></i
							></a>
						</li>
					</ul> -->

					<button
						class="btn btn-sm btn-soft-info me-2"
						tooltip="Editar caja"
						[disabled]="fila.deleted"
						(click)="editar(fila, modalGeneral)">
						<i class="mdi mdi-pencil-outline"></i>
					</button>
					<button
						[tooltip]="fila.deleted ? 'Habilitar' : 'Inhabilitar' "
						class="btn btn-sm me-2"
						[ngClass]="fila.deleted ? 'btn-success' : 'btn-danger' "
						(click)="habilitar(fila, tabla, fila.deleted ? 'Habilitar' : 'Inhabilitar' )"
						><i class="mdi mdi-power"></i>
					</button>
					<button class="btn btn-sm btn-info me-2" 
						tooltip="Detalle de la caja"
						(click)="detalleCaja(fila)">
						<i class="mdi mdi-eye"></i>
					</button>
					<button
						class="btn btn-sm btn-primary me-2"
						[disabled]="fila.deleted"
						tooltip="Aperturar Caja"
						(click)="aperturarCaja(fila, aperturaCierre)">
						<i class="bx bx-lock-open-alt"></i>
					</button>
					<button
						class="btn btn-sm btn-soft-dark me-2"
						tooltip="Cierre de caja"
						(click)="cierre(fila, modalGeneral)">					
						<i class="mdi mdi-lock"></i>
					</button>

				</div>
				<div *ngSwitchCase="'responsable'" class="text-center">
					{{fila['empleado']['nombre']}}
				</div>
				<div *ngSwitchCase="'aperturaCierre'">
					<span *ngIf="!fila.aperturado" class="badge bg-secondary font-size-10">
						Sin Aperturar
					</span>
					<span *ngIf="fila.aperturado" class="badge bg-primary font-size-10">
						Aperturado
					</span>					
				</div>
				<div *ngSwitchDefault>
					{{ fila[campo] }}
				</div>
			</td>
		</ng-template>
	</ng-template>
</ng-template>

<ng-template #modalGeneral let-modal>
	<div class="modal-header">
		<h5 class="modal-title" id="exampleModalLabel">{{ titleModal }}</h5>
		<button
			type="button"
			class="btn-close"
			data-bs-dismiss="modal"
			aria-label="Close"
			id="close-modal"
			(click)="cerrarModal()"
			[disabled]="onSubmitFormStatus"
		></button>
	</div>
	<div class="modal-body" id="form-create-edit-cash">
		<app-formulario-caja
			#appFormCaja
			[caja]="caja"
			[tipoMovimiento]="tipoMovimiento"
			[cajaIdNoUse]="cajaIdNoUse"
			(alActualizar)="modalRef.hide(); tabla.obtenerDatos()"
			(isChangeSubmitStatus)="isChangeSubmitStatus()"
		/>
	</div>
	<div class="modal-footer">
		<div class="hstack gap-2 justify-content-end">
			<button
				type="button"
				class="btn btn-light"
				data-bs-dismiss="modal"
				(click)="cerrarModal()"
				[disabled]="onSubmitFormStatus"
			>
				Cerrar
			</button>
			<button
				type="button"
				class="btn"
				[class]="{
					'btn-warning': caja && !tipoMovimiento,
					'btn-success': !caja || tipoMovimiento
				}"
				(click)="appFormCaja.confirmAndContinueSaving()"
				[disabled]="onSubmitFormStatus"
			>
				<app-simple-loader [isLoading]="onSubmitFormStatus" />
				{{
					onSubmitFormStatus
						? ' Espere un momento...'
						: caja && !tipoMovimiento
						? 'Guardar'
						: 'Registrar'
				}}
			</button>
		</div>
	</div>
</ng-template>

<ng-template #aperturaCierre let-modal>
  <accion-caja
  [datosCaja]="dataCaja"
  (alActualizar)="modalRef.hide(); tabla.obtenerDatos();"
  (cerrarModal)="modalRef.hide()"
  ></accion-caja>
</ng-template>
