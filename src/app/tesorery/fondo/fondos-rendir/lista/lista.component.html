<app-page-title title="Fondos a Rendir" [breadcrumbItems]="breadCrumbItems" />
<krn-tabla
	#tabla
	[titulo]="titulo"
	[datosService]="fondoRendirService"
	getAll="getAll"
	[formato]="formato"
	[textoBuscar]="textoBuscar"
	[isSubtable]="rel_prefix ? true : false"
	[templateFila]="undefined"
	[smallTable]="false"
	[softDelete]="false"
	(crearNuevo)="(null)"
	(alCrear)="aperturarNuevo(modalGeneral)"
	(alActualizar)="(null)"
	(alFiltrar)="(null)"
	(alEditar)="editar($event, modalGeneral)"
	campoEstado="estado"
	valueEstado="habilitado"
	(alHabilitar)="habilitar($event, tabla, 'habilitar')"
	(alDeshabilitar)="habilitar($event, tabla, 'inhabilitar')"
	[botonExportar]="false"
	[botonImportar]="false"
	[conOpciones]="false"
	[templateFila]="templateFila"
/>

<ng-template #templateFila let-fila="fila" let-cabeceras="cabeceras">
	<ng-template ngFor let-campo [ngForOf]="cabeceras">
		<ng-template *ngIf="formato.cabeceras[campo].visibleCheck; then tempTD" />
		<ng-template #tempTD>
			<td [ngSwitch]="campo">
				<div *ngSwitchCase="'acciones'">
					<ul class="list-unstyled hstack gap-1 mb-0">
						<li
							data-bs-toggle="tooltip"
							data-bs-placement="top"
							title="Editar"
							*ngIf="!fila.aperturado"
						>
							<button
								class="btn btn-sm btn-soft-info"
								[disabled]="fila.deleted"
								(click)="editar(fila, modalGeneral)"
							>
								<i class="mdi mdi-pencil-outline"></i>
							</button>
						</li>
						<li
							data-bs-toggle="tooltip"
							data-bs-placement="top"
							title="Operaciones"
						>
							<div
								class="btn-group"
								dropdown
								container="body"
								[isDisabled]="fila.cierre || fila.deleted"
							>
								<button
									id="button-basic"
									dropdownToggle
									type="button"
									class="btn btn-sm btn-light dropdown-toggle"
									aria-controls="dropdown-basic"
								>
									<i class="mdi mdi-cogs"></i
									><span class="mdi mdi-chevron-down"></span>
								</button>
								<ul
									id="dropdown-basic"
									*dropdownMenu
									class="dropdown-menu text-center"
									aria-labelledby="button-basic"
								>
									<li>
										<button
											class="dropdown-item"
											[disabled]="fila.saldo <= 0"
											(click)="
												descargos(fila, modalGeneral, 'DEVO', 'Devolución')
											"
										>
											Devolución <i class="mdi mdi-sync"></i>
										</button>
									</li>
									<li>
										<button
											class="dropdown-item bg-danger bg-opacity-75 rounded-4"
											(click)="descargos(fila, modalGeneral, 'CIERR', 'Cierre')"
										>
											Cierre <i class="mdi mdi-lock"></i>
										</button>
									</li>
								</ul>
							</div>
						</li>
						<li
							data-bs-toggle="tooltip"
							data-bs-placement="top"
							title="Detalle fondo"
						>
							<button class="btn btn-sm btn-info" (click)="detalleFondo(fila)">
								<i class="mdi mdi-eye"></i>
							</button>
						</li>
						<li
							data-bs-toggle="tooltip"
							data-bs-placement="top"
							title="Habilitar"
							*ngIf="fila.deleted"
						>
							<a
								class="btn btn-sm btn-success"
								(click)="habilitar(fila, tabla, 'habilitar')"
								><i class="mdi mdi-power"></i
							></a>
						</li>
						<li
							data-bs-toggle="tooltip"
							data-bs-placement="top"
							title="Inhabilitar"
							*ngIf="!fila.deleted"
						>
							<a
								data-bs-toggle="modal"
								class="btn btn-sm btn-danger"
								(click)="habilitar(fila, tabla, 'inhabilitar')"
								><i class="mdi mdi-power"></i
							></a>
						</li>
					</ul>
				</div>
				<div *ngSwitchCase="'importe'" class="text-end">
					{{ fila.importe }}
				</div>
				<div *ngSwitchCase="'saldo'" class="text-end">
					{{ fila.saldo }}
				</div>
				<div *ngSwitchCase="'fechaSolicitud'">
					{{ fila.fechaSolicitud | fechaSimple }}
				</div>
				<div *ngSwitchCase="'aperturado'" class="text-center">
					<span
						class="badge font-size-12"
						style="width: 30px"
						[ngClass]="{
							'bg-success': fila.aperturado,
							'bg-danger': !fila.aperturado
						}"
						>{{ fila.aperturado == true ? 'SI' : 'NO' }}</span
					>
				</div>
				<div *ngSwitchCase="'cierre'" class="text-center">
					<span
						class="badge font-size-12"
						style="width: 30px"
						[ngClass]="{
							'bg-danger': fila.cierre,
							'bg-secondary': !fila.cierre
						}"
						>{{ fila.cierre == true ? 'SI' : 'NO' }}</span
					>
				</div>
				<div *ngSwitchCase="'deleted'">
					<span *ngIf="!fila.deleted" class="badge bg-success font-size-10"
						><i class="mdi mdi-lock-open me-1"></i> Habilitado</span
					>
					<span *ngIf="fila.deleted" class="badge bg-danger font-size-10"
						><i class="mdi mdi-lock me-1"></i> Inhabilitado</span
					>
				</div>
				<div *ngSwitchDefault>
					{{ fila[campo] }}
				</div>
			</td>
		</ng-template>
	</ng-template>
</ng-template>

<ng-template #modalGeneral let-modal>
	<div class="modal-header">
		<h5 class="modal-title" id="exampleModalLabel">{{ titleModal }}</h5>
		<button
			type="button"
			class="btn-close"
			data-bs-dismiss="modal"
			aria-label="Close"
			id="close-modal"
			(click)="cerrarModal()"
			[disabled]="onSubmitFormStatus"
		></button>
	</div>
	<div class="modal-body" id="form-new-edit-operation-fund-to-render">
		<app-formulario-rendir
			#appFormFondoRendir
			[fondo]="fondo"
			[tipoDescargo]="tipoDescargo"
			(alActualizar)="modalRef.hide(); tabla.obtenerDatos()"
			(isChangeSubmitStatus)="isChangeSubmitStatus()"
		/>
	</div>
	<div class="modal-footer">
		<div class="hstack gap-2 justify-content-end">
			<button
				type="button"
				class="btn btn-light"
				data-bs-dismiss="modal"
				(click)="cerrarModal()"
				[disabled]="onSubmitFormStatus"
			>
				Cerrar
			</button>
			<button
				type="button"
				class="btn"
				[class]="{
					'btn-warning': titleModal == 'Editar',
					'btn-success': titleModal != 'Editar'
				}"
				(click)="appFormFondoRendir?.confirmAndContinueSaving()"
				[disabled]="onSubmitFormStatus"
			>
				<app-simple-loader [isLoading]="onSubmitFormStatus" />
				{{
					onSubmitFormStatus
						? ' Espere un momento...'
						: titleModal == 'Editar'
						? 'Guardar'
						: 'Registrar'
				}}
			</button>
		</div>
	</div>
</ng-template>
